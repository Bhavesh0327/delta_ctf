import json
from pwn import *

def encrypt_oracle(plaintext,r):
    r.recvline()
    r.sendline(plaintext.encode().hex().encode())
    ciphertext = eval(r.recvline().decode()[:-1])['ciphertext']
    r.recvline()
    r.sendline(b'y')
    return bytes.fromhex(ciphertext)

def attack(blocksize, r):
    plaintext = ""
    while True:
        needappend = (blocksize - len(plaintext)%blocksize - 1)*'A'
        if needappend == '':
            needappend = 'A'*blocksize
        data = needappend + plaintext
        samplecipher = encrypt_oracle(needappend, r)[0:len(data)+1]
        for i in range(32,127):
            blockcipher  = encrypt_oracle(data + chr(i), r)
            if blockcipher[0:len(data)+1] == samplecipher:
                plaintext+=chr(i)
                break
        print(plaintext)
        if plaintext[-1] == '}':
            break
    return plaintext

r = remote('deltahack.ninja', 4869)
print(attack(16, r))
